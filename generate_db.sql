
CREATE TYPE public.appointment_status AS ENUM (
    'scheduled',
    'no_show',
    'completed',
    'canceled'
);


CREATE TYPE public.role AS ENUM (
    'PATIENT',
    'DOCTOR',
    'ADMIN'
);


CREATE TABLE public.admins (
    admin_id bigint NOT NULL,
    hospital bigint NOT NULL,
    version bigint DEFAULT 0 NOT NULL
);


ALTER TABLE public.admins ALTER COLUMN admin_id ADD GENERATED BY DEFAULT AS IDENTITY (
    SEQUENCE NAME public.admins_id_seq
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1
);


CREATE TABLE public.appointment (
    id bigint NOT NULL,
    patient_id bigint NOT NULL,
    doctor_id bigint NOT NULL,
    start_time timestamp without time zone NOT NULL,
    end_time timestamp with time zone NOT NULL,
    status public.appointment_status NOT NULL,
    doctor_notes text,
    version bigint DEFAULT 0 NOT NULL
);




ALTER TABLE public.appointment ALTER COLUMN id ADD GENERATED BY DEFAULT AS IDENTITY (
    SEQUENCE NAME public.appoinment_id_seq
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1
);


CREATE TABLE public.doctor_schedules (
    doctor_id bigint NOT NULL,
    version bigint DEFAULT 0 NOT NULL,
    schedule jsonb NOT NULL
);


ALTER TABLE public.doctor_schedules ALTER COLUMN doctor_id ADD GENERATED BY DEFAULT AS IDENTITY (
    SEQUENCE NAME public.doctor_week_schedule_schedule_id_seq
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1
);

CREATE TABLE public.doctors (
    doctor_id bigint NOT NULL,
    office bigint NOT NULL,
    hospital_id bigint NOT NULL,
    specialty_id bigint,
    version bigint DEFAULT 0 NOT NULL
);

ALTER TABLE public.doctors ALTER COLUMN doctor_id ADD GENERATED BY DEFAULT AS IDENTITY (
    SEQUENCE NAME public.doctors_info_doctor_id_seq
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1
);


CREATE TABLE public.doctors_schedule_override (
    doctor_id bigint NOT NULL,
    start_date date NOT NULL,
    end_date date NOT NULL,
    time_start time without time zone,
    reason text NOT NULL,
    id bigint NOT NULL,
    available boolean NOT NULL,
    time_end time without time zone,
    version bigint DEFAULT 0 NOT NULL
);


CREATE TABLE public.email_verification_tokens (
    id integer NOT NULL,
    user_id integer NOT NULL,
    token character varying(255) NOT NULL,
    expiry_date timestamp without time zone NOT NULL,
    used boolean DEFAULT false,
    created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP
);


CREATE SEQUENCE public.email_verification_tokens_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


ALTER SEQUENCE public.email_verification_tokens_id_seq OWNED BY public.email_verification_tokens.id;


CREATE TABLE public.hospitals (
    id bigint NOT NULL,
    hospital_name text NOT NULL,
    state text NOT NULL,
    country text NOT NULL,
    postal_code text NOT NULL,
    city text NOT NULL,
    version bigint DEFAULT 0 NOT NULL,
    appointment_interval integer NOT NULL,
    street_address character varying(255),
    state_province character varying(100)
);



ALTER TABLE public.hospitals ALTER COLUMN id ADD GENERATED BY DEFAULT AS IDENTITY (
    SEQUENCE NAME public.hospitals_id_seq
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1
);




CREATE TABLE public.specialties (
    id bigint NOT NULL,
    name text NOT NULL
);



ALTER TABLE public.specialties ALTER COLUMN id ADD GENERATED BY DEFAULT AS IDENTITY (
    SEQUENCE NAME public.specialties_id_seq
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1
);

CREATE TABLE public.treatment (
    id bigint NOT NULL,
    patient_id bigint NOT NULL,
    doctor_id bigint,
    instructions text NOT NULL,
    appointment_id bigint NOT NULL,
    medication_names text[],
    version bigint DEFAULT 0 NOT NULL,
    created_at timestamp with time zone NOT NULL
);



ALTER TABLE public.treatment ALTER COLUMN id ADD GENERATED BY DEFAULT AS IDENTITY (
    SEQUENCE NAME public.treatment_id_seq
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1
);


CREATE TABLE public.users (
    id bigint NOT NULL,
    name text NOT NULL,
    surname text NOT NULL,
    password_hash character varying NOT NULL,
    role public.role NOT NULL,
    email text NOT NULL,
    login text NOT NULL,
    version bigint DEFAULT 0 NOT NULL,
    email_verified boolean DEFAULT false
);

ALTER TABLE public.users ALTER COLUMN id ADD GENERATED BY DEFAULT AS IDENTITY (
    SEQUENCE NAME public.users_id_seq
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1
);


ALTER TABLE ONLY public.email_verification_tokens ALTER COLUMN id SET DEFAULT nextval('public.email_verification_tokens_id_seq'::regclass);




INSERT INTO public.admins (admin_id, hospital, version) VALUES
(30, 4, 0),
(31, 5, 0),
(32, 6, 0);



INSERT INTO public.doctor_schedules (doctor_id, version, schedule) VALUES
(33, 0, '{"end": "17:00", "days": [1, 2, 3, 4, 5], "start": "09:00"}'),
(34, 0, '{"end": "17:00", "days": [1, 2, 3, 4, 5], "start": "09:00"}'),
(35, 0, '{"end": "17:00", "days": [1, 2, 3, 4, 5], "start": "09:00"}'),
(36, 0, '{"end": "17:00", "days": [1, 2, 3, 4, 5], "start": "09:00"}'),
(37, 0, '{"end": "17:00", "days": [1, 2, 3, 4, 5], "start": "09:00"}'),
(38, 0, '{"end": "17:00", "days": [1, 2, 3, 4, 5], "start": "09:00"}'),
(39, 0, '{"end": "17:00", "days": [1, 2, 3, 4, 5], "start": "09:00"}'),
(40, 0, '{"end": "17:00", "days": [1, 2, 3, 4, 5], "start": "09:00"}'),
(41, 0, '{"end": "17:00", "days": [1, 2, 3, 4, 5], "start": "09:00"}'),
(42, 0, '{"end": "17:00", "days": [1, 2, 3, 4, 5], "start": "09:00"}'),
(43, 0, '{"end": "17:00", "days": [1, 2, 3, 4, 5], "start": "09:00"}');


INSERT INTO public.doctors (doctor_id, office, hospital_id, specialty_id, version) VALUES
(33, 101, 4, 2, 0),
(34, 102, 4, 5, 0),
(35, 103, 4, 8, 0),
(36, 104, 4, 12, 0),
(37, 201, 5, 15, 0),
(38, 202, 5, 18, 0),
(39, 203, 5, 22, 0),
(40, 301, 6, 25, 0),
(41, 302, 6, 30, 0),
(42, 303, 6, 35, 0),
(43, 304, 6, 38, 0);


INSERT INTO public.hospitals (id, hospital_name, state, country, postal_code, city, version, appointment_interval, street_address, state_province) VALUES
(5, 'Szpital Uniwersytecki Kraków', 'Małopolskie', 'Poland', '31-501', 'Krakow', 0, 30, 'ul. Kopernika 45', 'Małopolskie'),
(6, 'Szpital Miejski Gdańsk', 'Pomorskie', 'Poland', '80-001', 'Gdansk', 0, 30, 'ul. Długa 67', 'Pomorskie'),
(4, 'Szpital Centralny Warszawa', 'Mazowieckie', 'Poland', '00-001', 'Warsaw', 0, 30, 'ul. Marszałkowska 1234', 'Mazowieckie');


INSERT INTO public.specialties (id, name) VALUES
(1, 'Allergology'),
(2, 'Anesthesiology and intensive care'),
(3, 'Angiology'),
(4, 'Audiology and phoniatrics'),
(5, 'Balneology and physical medicine'),
(6, 'Pediatric surgery'),
(7, 'Thoracic surgery'),
(8, 'Vascular surgery'),
(9, 'General surgery'),
(10, 'Oncological surgery'),
(11, 'Plastic surgery'),
(12, 'Oral and maxillofacial surgery'),
(13, 'Pulmonology'),
(14, 'Pediatric pulmonology'),
(15, 'Internal medicine'),
(16, 'Infectious diseases'),
(17, 'Dermatology and venereology'),
(18, 'Diabetology'),
(19, 'Laboratory diagnostics'),
(20, 'Endocrinology'),
(21, 'Gynecological endocrinology and reproduction medicine'),
(22, 'Pediatric endocrinology and diabetology'),
(23, 'Epidemiology'),
(24, 'Clinical pharmacology'),
(25, 'Gastroenterology'),
(26, 'Pediatric gastroenterology'),
(27, 'Clinical genetics'),
(28, 'Geriatrics'),
(29, 'Oncological gynecology'),
(30, 'Hematology'),
(31, 'Hypertensive medicine'),
(32, 'Clinical immunology'),
(33, 'Intensive care'),
(34, 'Cardiac surgery'),
(35, 'Cardiology'),
(36, 'Pediatric cardiology'),
(37, 'Aviation medicine'),
(38, 'Marine and tropical medicine'),
(39, 'Nuclear medicine'),
(40, 'Palliative medicine'),
(41, 'Occupational medicine'),
(42, 'Emergency medicine'),
(43, 'Family medicine'),
(44, 'Forensic medicine'),
(45, 'Sports medicine'),
(46, 'Medical microbiology'),
(47, 'Nephrology'),
(48, 'Pediatric nephrology'),
(49, 'Neonatology'),
(50, 'Neurosurgery'),
(51, 'Neurology'),
(52, 'Pediatric neurology'),
(53, 'Neuropathology'),
(54, 'Ophthalmology'),
(55, 'Pediatric oncology and hematology'),
(56, 'Clinical oncology'),
(57, 'Orthopedics and traumatology'),
(58, 'Otorhinolaryngology'),
(59, 'Pediatric otorhinolaryngology'),
(60, 'Clinical pathology'),
(61, 'Pediatrics'),
(62, 'Metabolic pediatrics'),
(63, 'Perinatology'),
(64, 'Obstetrics and gynecology'),
(65, 'Psychiatry'),
(66, 'Psychiatry of children and adolescents'),
(67, 'Radiology and diagnostic imaging'),
(68, 'Oncological radiotherapy'),
(69, 'Medical rehabilitation'),
(70, 'Rheumatology'),
(71, 'Sexology'),
(72, 'Postgraduate medical internship'),
(73, 'Clinical toxicology'),
(74, 'Transfusion medicine'),
(75, 'Transplantation medicine'),
(76, 'Urology'),
(77, 'Pediatric urology'),
(78, 'Public health medicine');



INSERT INTO public.users (id, name, surname, password_hash, role, email, login, version, email_verified) VALUES
(30, 'Jan', 'Kowalski', 'ef92b778bafe771e89245b89ecbc08a44a4e166c06659911881f383d4473e94f', 'ADMIN', 'admin.warsaw@hospital.com', 'admin.warsaw', 0, true),
(31, 'Anna', 'Nowak', 'ef92b778bafe771e89245b89ecbc08a44a4e166c06659911881f383d4473e94f', 'ADMIN', 'admin.krakow@hospital.com', 'admin.krakow', 0, true),
(32, 'Piotr', 'Wiśniewski', 'ef92b778bafe771e89245b89ecbc08a44a4e166c06659911881f383d4473e94f', 'ADMIN', 'admin.gdansk@hospital.com', 'admin.gdansk', 0, true),
(33, 'Tomasz', 'Lewandowski', 'ef92b778bafe771e89245b89ecbc08a44a4e166c06659911881f383d4473e94f', 'DOCTOR', 'tomasz.lewandowski@warszawa-hospital.pl', 'dr.lewandowski', 0, true),
(34, 'Katarzyna', 'Kamińska', 'ef92b778bafe771e89245b89ecbc08a44a4e166c06659911881f383d4473e94f', 'DOCTOR', 'katarzyna.kaminska@warszawa-hospital.pl', 'dr.kaminska', 0, true),
(35, 'Michał', 'Zieliński', 'ef92b778bafe771e89245b89ecbc08a44a4e166c06659911881f383d4473e94f', 'DOCTOR', 'michal.zielinski@warszawa-hospital.pl', 'dr.zielinski', 0, true),
(36, 'Ewa', 'Woźniak', 'ef92b778bafe771e89245b89ecbc08a44a4e166c06659911881f383d4473e94f', 'DOCTOR', 'ewa.wozniak@warszawa-hospital.pl', 'dr.wozniak', 0, true),
(37, 'Agnieszka', 'Szymańska', 'ef92b778bafe771e89245b89ecbc08a44a4e166c06659911881f383d4473e94f', 'DOCTOR', 'agnieszka.szymanska@krakow-hospital.pl', 'dr.szymanska', 0, true),
(38, 'Marcin', 'Kowalczyk', 'ef92b778bafe771e89245b89ecbc08a44a4e166c06659911881f383d4473e94f', 'DOCTOR', 'marcin.kowalczyk@krakow-hospital.pl', 'dr.kowalczyk', 0, true),
(39, 'Joanna', 'Dąbrowska', 'ef92b778bafe771e89245b89ecbc08a44a4e166c06659911881f383d4473e94f', 'DOCTOR', 'joanna.dabrowska@krakow-hospital.pl', 'dr.dabrowska', 0, true),
(40, 'Paweł', 'Kozłowski', 'ef92b778bafe771e89245b89ecbc08a44a4e166c06659911881f383d4473e94f', 'DOCTOR', 'pawel.kozlowski@gdansk-hospital.pl', 'dr.kozlowski', 0, true),
(41, 'Magdalena', 'Jankowska', 'ef92b778bafe771e89245b89ecbc08a44a4e166c06659911881f383d4473e94f', 'DOCTOR', 'magdalena.jankowska@gdansk-hospital.pl', 'dr.jankowska', 0, true),
(42, 'Krzysztof', 'Mazur', 'ef92b778bafe771e89245b89ecbc08a44a4e166c06659911881f383d4473e94f', 'DOCTOR', 'krzysztof.mazur@gdansk-hospital.pl', 'dr.mazur', 0, true),
(43, 'Anna', 'Krawczyk', 'ef92b778bafe771e89245b89ecbc08a44a4e166c06659911881f383d4473e94f', 'DOCTOR', 'anna.krawczyk@gdansk-hospital.pl', 'dr.krawczyk', 0, true),
(58, 'Jack', 'Black', 'ef92b778bafe771e89245b89ecbc08a44a4e166c06659911881f383d4473e94f', 'PATIENT', 'jackblack@email.com', 'jblack', 0, true);


ALTER TABLE ONLY public.admins
    ADD CONSTRAINT admins_pkey PRIMARY KEY (admin_id);




ALTER TABLE ONLY public.appointment
    ADD CONSTRAINT appoinment_pkey PRIMARY KEY (id);




ALTER TABLE ONLY public.doctor_schedules
    ADD CONSTRAINT doctor_schedules_pkey PRIMARY KEY (doctor_id);




ALTER TABLE ONLY public.doctors
    ADD CONSTRAINT doctors_info_pkey PRIMARY KEY (doctor_id);




ALTER TABLE ONLY public.doctors_schedule_override
    ADD CONSTRAINT doctors_schedule_override_pkey PRIMARY KEY (id);




ALTER TABLE ONLY public.email_verification_tokens
    ADD CONSTRAINT email_verification_tokens_pkey PRIMARY KEY (id);




ALTER TABLE ONLY public.email_verification_tokens
    ADD CONSTRAINT email_verification_tokens_token_key UNIQUE (token);




ALTER TABLE ONLY public.hospitals
    ADD CONSTRAINT hospitals_pkey PRIMARY KEY (id);



ALTER TABLE ONLY public.specialties
    ADD CONSTRAINT specialties_pkey PRIMARY KEY (id);



ALTER TABLE ONLY public.treatment
    ADD CONSTRAINT treatment_pkey PRIMARY KEY (id);



ALTER TABLE ONLY public.users
    ADD CONSTRAINT users_email_key UNIQUE (email);



ALTER TABLE ONLY public.users
    ADD CONSTRAINT users_login_key UNIQUE (login);



ALTER TABLE ONLY public.users
    ADD CONSTRAINT users_pkey PRIMARY KEY (id);



CREATE INDEX idx_hospitals_city ON public.hospitals USING btree (city);




CREATE INDEX idx_hospitals_city_gin ON public.hospitals USING gin (to_tsvector('english'::regconfig, COALESCE(city, ''::text)));


CREATE INDEX idx_hospitals_postal_code ON public.hospitals USING btree (postal_code);



CREATE INDEX idx_hospitals_street_address_gin ON public.hospitals USING gin (to_tsvector('english'::regconfig, (COALESCE(street_address, ''::character varying))::text));



CREATE INDEX idx_verification_tokens_token ON public.email_verification_tokens USING btree (token);



CREATE INDEX idx_verification_tokens_user ON public.email_verification_tokens USING btree (user_id);



ALTER TABLE ONLY public.admins
    ADD CONSTRAINT admins_admin_id_fkey FOREIGN KEY (admin_id) REFERENCES public.users(id) ON UPDATE CASCADE ON DELETE CASCADE;


ALTER TABLE ONLY public.appointment
    ADD CONSTRAINT appoinment_doctor_id_fkey FOREIGN KEY (doctor_id) REFERENCES public.doctors(doctor_id) ON UPDATE CASCADE ON DELETE CASCADE;



ALTER TABLE ONLY public.appointment
    ADD CONSTRAINT appointment_patient_id_fkey FOREIGN KEY (patient_id) REFERENCES public.users(id) ON UPDATE CASCADE ON DELETE CASCADE;




ALTER TABLE ONLY public.doctor_schedules
    ADD CONSTRAINT doctor_week_schedules_doctor_id_fkey FOREIGN KEY (doctor_id) REFERENCES public.doctors(doctor_id) ON UPDATE CASCADE ON DELETE CASCADE;


ALTER TABLE ONLY public.doctors
    ADD CONSTRAINT doctors_hospital_id_fkey FOREIGN KEY (hospital_id) REFERENCES public.hospitals(id) ON UPDATE CASCADE ON DELETE CASCADE;



ALTER TABLE ONLY public.doctors_schedule_override
    ADD CONSTRAINT doctors_schedule_override_doctor_id_fkey FOREIGN KEY (doctor_id) REFERENCES public.doctors(doctor_id) ON UPDATE CASCADE ON DELETE CASCADE;




ALTER TABLE ONLY public.doctors
    ADD CONSTRAINT doctors_specialty_id_fkey FOREIGN KEY (specialty_id) REFERENCES public.specialties(id) ON UPDATE CASCADE ON DELETE SET NULL;



ALTER TABLE ONLY public.email_verification_tokens
    ADD CONSTRAINT email_verification_tokens_user_id_fkey FOREIGN KEY (user_id) REFERENCES public.users(id) ON UPDATE CASCADE ON DELETE CASCADE;




ALTER TABLE ONLY public.treatment
    ADD CONSTRAINT treatment_doctor_id_fkey FOREIGN KEY (doctor_id) REFERENCES public.doctors(doctor_id) ON UPDATE CASCADE ON DELETE SET NULL;



ALTER TABLE ONLY public.treatment
    ADD CONSTRAINT treatment_patient_id_fkey FOREIGN KEY (patient_id) REFERENCES public.users(id) ON UPDATE CASCADE ON DELETE CASCADE;



ALTER TABLE public.admins ENABLE ROW LEVEL SECURITY;



ALTER TABLE public.appointment ENABLE ROW LEVEL SECURITY;


ALTER TABLE public.doctor_schedules ENABLE ROW LEVEL SECURITY;



ALTER TABLE public.doctors ENABLE ROW LEVEL SECURITY;



ALTER TABLE public.doctors_schedule_override ENABLE ROW LEVEL SECURITY;



ALTER TABLE public.email_verification_tokens ENABLE ROW LEVEL SECURITY;



ALTER TABLE public.hospitals ENABLE ROW LEVEL SECURITY;


ALTER TABLE public.specialties ENABLE ROW LEVEL SECURITY;



ALTER TABLE public.treatment ENABLE ROW LEVEL SECURITY;



ALTER TABLE public.users ENABLE ROW LEVEL SECURITY;
